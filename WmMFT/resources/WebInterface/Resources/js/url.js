/*!
 * URI.js - Mutating URLs
 *
 * Version: 1.11.2
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.com/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *   GPL v3 http://opensource.org/licenses/GPL-3.0
 *
 */
(function(e,t){if(typeof exports==="object"){module.exports=t(require("./punycode"),require("./IPv6"),require("./SecondLevelDomains"))}else if(typeof define==="function"&&define.amd){define(["./punycode","./IPv6","./SecondLevelDomains"],t)}else{e.URI=t(e.punycode,e.IPv6,e.SecondLevelDomains,e)}})(this,function(e,t,n,r){"use strict";function s(e,t){if(!(this instanceof s)){return new s(e,t)}if(e===undefined){if(typeof location!=="undefined"){e=location.href+""}else{e=""}}this.href(e);if(t!==undefined){return this.absoluteTo(t)}return this}function a(e){return e.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function f(e){if(e===undefined){return"Undefined"}return String(Object.prototype.toString.call(e)).slice(8,-1)}function l(e){return f(e)==="Array"}function c(e,t){var n={};var r,i;if(l(t)){for(r=0,i=t.length;r<i;r++){n[t[r]]=true}}else{n[t]=true}for(r=0,i=e.length;r<i;r++){if(n[e[r]]!==undefined){e.splice(r,1);i--;r--}}return e}function h(e,t){var n,r;if(l(t)){for(n=0,r=t.length;n<r;n++){if(!h(e,t[n])){return false}}return true}var i=f(t);for(n=0,r=e.length;n<r;n++){if(i==="RegExp"){if(typeof e[n]==="string"&&e[n].match(t)){return true}}else if(e[n]===t){return true}}return false}function p(e,t){if(!l(e)||!l(t)){return false}if(e.length!==t.length){return false}e.sort();t.sort();for(var n=0,r=e.length;n<r;n++){if(e[n]!==t[n]){return false}}return true}function d(e){return escape(e)}function v(e){return encodeURIComponent(e).replace(/[!'()*]/g,d).replace(/\*/g,"%2A")}var i=r&&r.URI;var o=s.prototype;var u=Object.prototype.hasOwnProperty;s._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,duplicateQueryParameters:s.duplicateQueryParameters,escapeQuerySpace:s.escapeQuerySpace}};s.duplicateQueryParameters=false;s.escapeQuerySpace=true;s.protocol_expression=/^[a-z][a-z0-9-+-]*$/i;s.idn_expression=/[^a-z0-9\.-]/i;s.punycode_expression=/(xn--)/i;s.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/;s.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/;s.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/ig;s.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"};s.invalid_hostname_characters=/[^a-zA-Z0-9\.-]/;s.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src"};s.getDomAttribute=function(e){if(!e||!e.nodeName){return undefined}var t=e.nodeName.toLowerCase();if(t==="input"&&e.type!=="image"){return undefined}return s.domAttributes[t]};s.encode=v;s.decode=decodeURIComponent;s.iso8859=function(){s.encode=escape;s.decode=unescape};s.unicode=function(){s.encode=v;s.decode=decodeURIComponent};s.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}}};s.encodeQuery=function(e,t){var n=s.encode(e+"");return t?n.replace(/%20/g,"+"):n};s.decodeQuery=function(e,t){e+="";try{return s.decode(t?e.replace(/\+/g,"%20"):e)}catch(n){return e}};s.recodePath=function(e){var t=(e+"").split("/");for(var n=0,r=t.length;n<r;n++){t[n]=s.encodePathSegment(s.decode(t[n]))}return t.join("/")};s.decodePath=function(e){var t=(e+"").split("/");for(var n=0,r=t.length;n<r;n++){t[n]=s.decodePathSegment(t[n])}return t.join("/")};var m={encode:"encode",decode:"decode"};var g;var y=function(e,t){return function(n){return s[t](n+"").replace(s.characters[e][t].expression,function(n){return s.characters[e][t].map[n]})}};for(g in m){s[g+"PathSegment"]=y("pathname",m[g])}s.encodeReserved=y("reserved","encode");s.parse=function(e,t){var n;if(!t){t={}}n=e.indexOf("#");if(n>-1){t.fragment=e.substring(n+1)||null;e=e.substring(0,n)}n=e.indexOf("?");if(n>-1){t.query=e.substring(n+1)||null;e=e.substring(0,n)}if(e.substring(0,2)==="//"){t.protocol=null;e=e.substring(2);e=s.parseAuthority(e,t)}else{n=e.indexOf(":");if(n>-1){t.protocol=e.substring(0,n)||null;if(t.protocol&&!t.protocol.match(s.protocol_expression)){t.protocol=undefined}else if(t.protocol==="file"){e=e.substring(n+3)}else if(e.substring(n+1,n+3)==="//"){e=e.substring(n+3);e=s.parseAuthority(e,t)}else{e=e.substring(n+1);t.urn=true}}}t.path=e;return t};s.parseHost=function(e,t){var n=e.indexOf("/");var r;var i;if(n===-1){n=e.length}if(e.charAt(0)==="["){r=e.indexOf("]");t.hostname=e.substring(1,r)||null;t.port=e.substring(r+2,n)||null}else if(e.indexOf(":")!==e.lastIndexOf(":")){t.hostname=e.substring(0,n)||null;t.port=null}else{i=e.substring(0,n).split(":");t.hostname=i[0]||null;t.port=i[1]||null}if(t.hostname&&e.substring(n).charAt(0)!=="/"){n++;e="/"+e}return e.substring(n)||"/"};s.parseAuthority=function(e,t){e=s.parseUserinfo(e,t);return s.parseHost(e,t)};s.parseUserinfo=function(e,t){var n=e.indexOf("/");var r=n>-1?e.lastIndexOf("@",n):e.indexOf("@");var i;if(r>-1&&(n===-1||r<n)){i=e.substring(0,r).split(":");t.username=i[0]?s.decode(i[0]):null;i.shift();t.password=i[0]?s.decode(i.join(":")):null;e=e.substring(r+1)}else{t.username=null;t.password=null}return e};s.parseQuery=function(e,t){if(!e){return{}}e=e.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,"");if(!e){return{}}var n={};var r=e.split("&");var i=r.length;var o,u,a;for(var f=0;f<i;f++){o=r[f].split("=");u=s.decodeQuery(o.shift(),t);a=o.length?s.decodeQuery(o.join("="),t):null;if(n[u]){if(typeof n[u]==="string"){n[u]=[n[u]]}n[u].push(a)}else{n[u]=a}}return n};s.build=function(e){var t="";if(e.protocol){t+=e.protocol+":"}if(!e.urn&&(t||e.hostname)){t+="//"}t+=s.buildAuthority(e)||"";if(typeof e.path==="string"){if(e.path.charAt(0)!=="/"&&typeof e.hostname==="string"){t+="/"}t+=e.path}if(typeof e.query==="string"&&e.query){t+="?"+e.query}if(typeof e.fragment==="string"&&e.fragment){t+="#"+e.fragment}return t};s.buildHost=function(e){var t="";if(!e.hostname){return""}else if(s.ip6_expression.test(e.hostname)){if(e.port){t+="["+e.hostname+"]:"+e.port}else{t+=e.hostname}}else{t+=e.hostname;if(e.port){t+=":"+e.port}}return t};s.buildAuthority=function(e){return s.buildUserinfo(e)+s.buildHost(e)};s.buildUserinfo=function(e){var t="";if(e.username){t+=s.encode(e.username);if(e.password){t+=":"+s.encode(e.password);t+="@"}else{t+=":@"}}return t};s.buildQuery=function(e,t,n){var r="";var i,o,a,f;for(o in e){if(u.call(e,o)&&o){if(l(e[o])){i={};for(a=0,f=e[o].length;a<f;a++){if(e[o][a]!==undefined&&i[e[o][a]+""]===undefined){r+="&"+s.buildQueryParameter(o,e[o][a],n);if(t!==true){i[e[o][a]+""]=true}}}}else if(e[o]!==undefined){r+="&"+s.buildQueryParameter(o,e[o],n)}}}return r.substring(1)};s.buildQueryParameter=function(e,t,n){return s.encodeQuery(e,n)+(t!==null?"="+s.encodeQuery(t,n):"")};s.addQuery=function(e,t,n){if(typeof t==="object"){for(var r in t){if(u.call(t,r)){s.addQuery(e,r,t[r])}}}else if(typeof t==="string"){if(e[t]===undefined){e[t]=n;return}else if(typeof e[t]==="string"){e[t]=[e[t]]}if(!l(n)){n=[n]}e[t]=e[t].concat(n)}else{throw new TypeError("URI.addQuery() accepts an object, string as the name parameter")}};s.removeQuery=function(e,t,n){var r,i,o;if(l(t)){for(r=0,i=t.length;r<i;r++){e[t[r]]=undefined}}else if(typeof t==="object"){for(o in t){if(u.call(t,o)){s.removeQuery(e,o,t[o])}}}else if(typeof t==="string"){if(n!==undefined){if(e[t]===n){e[t]=undefined}else if(l(e[t])){e[t]=c(e[t],n)}}else{e[t]=undefined}}else{throw new TypeError("URI.addQuery() accepts an object, string as the first parameter")}};s.hasQuery=function(e,t,n,r){if(typeof t==="object"){for(var i in t){if(u.call(t,i)){if(!s.hasQuery(e,i,t[i])){return false}}}return true}else if(typeof t!=="string"){throw new TypeError("URI.hasQuery() accepts an object, string as the name parameter")}switch(f(n)){case"Undefined":return t in e;case"Boolean":var o=Boolean(l(e[t])?e[t].length:e[t]);return n===o;case"Function":return!!n(e[t],t,e);case"Array":if(!l(e[t])){return false}var a=r?h:p;return a(e[t],n);case"RegExp":if(!l(e[t])){return Boolean(e[t]&&e[t].match(n))}if(!r){return false}return h(e[t],n);case"Number":n=String(n);case"String":if(!l(e[t])){return e[t]===n}if(!r){return false}return h(e[t],n);default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}};s.commonPath=function(e,t){var n=Math.min(e.length,t.length);var r;for(r=0;r<n;r++){if(e.charAt(r)!==t.charAt(r)){r--;break}}if(r<1){return e.charAt(0)===t.charAt(0)&&e.charAt(0)==="/"?"/":""}if(e.charAt(r)!=="/"||t.charAt(r)!=="/"){r=e.substring(0,r).lastIndexOf("/")}return e.substring(0,r+1)};s.withinString=function(e,t){return e.replace(s.find_uri_expression,t)};s.ensureValidHostname=function(t){if(t.match(s.invalid_hostname_characters)){if(!e){throw new TypeError("Hostname '"+t+"' contains characters other than [A-Z0-9.-] and Punycode.js is not available")}if(e.toASCII(t).match(s.invalid_hostname_characters)){throw new TypeError("Hostname '"+t+"' contains characters other than [A-Z0-9.-]")}}};s.noConflict=function(e){if(e){var n={URI:this.noConflict()};if(URITemplate&&typeof URITemplate.noConflict=="function"){n.URITemplate=URITemplate.noConflict()}if(t&&typeof t.noConflict=="function"){n.IPv6=t.noConflict()}if(SecondLevelDomains&&typeof SecondLevelDomains.noConflict=="function"){n.SecondLevelDomains=SecondLevelDomains.noConflict()}return n}else if(r.URI===this){r.URI=i}return this};o.build=function(e){if(e===true){this._deferred_build=true}else if(e===undefined||this._deferred_build){this._string=s.build(this._parts);this._deferred_build=false}return this};o.clone=function(){return new s(this)};o.valueOf=o.toString=function(){return this.build(false)._string};m={protocol:"protocol",username:"username",password:"password",hostname:"hostname",port:"port"};y=function(e){return function(t,n){if(t===undefined){return this._parts[e]||""}else{this._parts[e]=t||null;this.build(!n);return this}}};for(g in m){o[g]=y(m[g])}m={query:"?",fragment:"#"};y=function(e,t){return function(n,r){if(n===undefined){return this._parts[e]||""}else{if(n!==null){n=n+"";if(n.charAt(0)===t){n=n.substring(1)}}this._parts[e]=n;this.build(!r);return this}}};for(g in m){o[g]=y(g,m[g])}m={search:["?","query"],hash:["#","fragment"]};y=function(e,t){return function(n,r){var i=this[e](n,r);return typeof i==="string"&&i.length?t+i:i}};for(g in m){o[g]=y(m[g][1],m[g][0])}o.pathname=function(e,t){if(e===undefined||e===true){var n=this._parts.path||(this._parts.hostname?"/":"");return e?s.decodePath(n):n}else{this._parts.path=e?s.recodePath(e):"/";this.build(!t);return this}};o.path=o.pathname;o.href=function(e,t){var n;if(e===undefined){return this.toString()}this._string="";this._parts=s._parts();var r=e instanceof s;var i=typeof e==="object"&&(e.hostname||e.path||e.pathname);if(e.nodeName){var o=s.getDomAttribute(e);e=e[o]||"";i=false}if(!r&&i&&e.pathname!==undefined){e=e.toString()}if(typeof e==="string"){this._parts=s.parse(e,this._parts)}else if(r||i){var a=r?e._parts:e;for(n in a){if(u.call(this._parts,n)){this._parts[n]=a[n]}}}else{throw new TypeError("invalid input")}this.build(!t);return this};o.is=function(e){var t=false;var r=false;var i=false;var o=false;var u=false;var a=false;var f=false;var l=!this._parts.urn;if(this._parts.hostname){l=false;r=s.ip4_expression.test(this._parts.hostname);i=s.ip6_expression.test(this._parts.hostname);t=r||i;o=!t;u=o&&n&&n.has(this._parts.hostname);a=o&&s.idn_expression.test(this._parts.hostname);f=o&&s.punycode_expression.test(this._parts.hostname)}switch(e.toLowerCase()){case"relative":return l;case"absolute":return!l;case"domain":case"name":return o;case"sld":return u;case"ip":return t;case"ip4":case"ipv4":case"inet4":return r;case"ip6":case"ipv6":case"inet6":return i;case"idn":return a;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return f}return null};var b=o.protocol;var w=o.port;var E=o.hostname;o.protocol=function(e,t){if(e!==undefined){if(e){e=e.replace(/:(\/\/)?$/,"");if(e.match(/[^a-zA-z0-9\.+-]/)){throw new TypeError("Protocol '"+e+"' contains characters other than [A-Z0-9.+-]")}}}return b.call(this,e,t)};o.scheme=o.protocol;o.port=function(e,t){if(this._parts.urn){return e===undefined?"":this}if(e!==undefined){if(e===0){e=null}if(e){e+="";if(e.charAt(0)===":"){e=e.substring(1)}if(e.match(/[^0-9]/)){throw new TypeError("Port '"+e+"' contains characters other than [0-9]")}}}return w.call(this,e,t)};o.hostname=function(e,t){if(this._parts.urn){return e===undefined?"":this}if(e!==undefined){var n={};s.parseHost(e,n);e=n.hostname}return E.call(this,e,t)};o.host=function(e,t){if(this._parts.urn){return e===undefined?"":this}if(e===undefined){return this._parts.hostname?s.buildHost(this._parts):""}else{s.parseHost(e,this._parts);this.build(!t);return this}};o.authority=function(e,t){if(this._parts.urn){return e===undefined?"":this}if(e===undefined){return this._parts.hostname?s.buildAuthority(this._parts):""}else{s.parseAuthority(e,this._parts);this.build(!t);return this}};o.userinfo=function(e,t){if(this._parts.urn){return e===undefined?"":this}if(e===undefined){if(!this._parts.username){return""}var n=s.buildUserinfo(this._parts);return n.substring(0,n.length-1)}else{if(e[e.length-1]!=="@"){e+="@"}s.parseUserinfo(e,this._parts);this.build(!t);return this}};o.resource=function(e,t){var n;if(e===undefined){return this.path()+this.search()+this.hash()}n=s.parse(e);this._parts.path=n.path;this._parts.query=n.query;this._parts.fragment=n.fragment;this.build(!t);return this};o.subdomain=function(e,t){if(this._parts.urn){return e===undefined?"":this}if(e===undefined){if(!this._parts.hostname||this.is("IP")){return""}var n=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,n)||""}else{var r=this._parts.hostname.length-this.domain().length;var i=this._parts.hostname.substring(0,r);var o=new RegExp("^"+a(i));if(e&&e.charAt(e.length-1)!=="."){e+="."}if(e){s.ensureValidHostname(e)}this._parts.hostname=this._parts.hostname.replace(o,e);this.build(!t);return this}};o.domain=function(e,t){if(this._parts.urn){return e===undefined?"":this}if(typeof e==="boolean"){t=e;e=undefined}if(e===undefined){if(!this._parts.hostname||this.is("IP")){return""}var n=this._parts.hostname.match(/\./g);if(n&&n.length<2){return this._parts.hostname}var r=this._parts.hostname.length-this.tld(t).length-1;r=this._parts.hostname.lastIndexOf(".",r-1)+1;return this._parts.hostname.substring(r)||""}else{if(!e){throw new TypeError("cannot set domain empty")}s.ensureValidHostname(e);if(!this._parts.hostname||this.is("IP")){this._parts.hostname=e}else{var i=new RegExp(a(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(i,e)}this.build(!t);return this}};o.tld=function(e,t){if(this._parts.urn){return e===undefined?"":this}if(typeof e==="boolean"){t=e;e=undefined}if(e===undefined){if(!this._parts.hostname||this.is("IP")){return""}var r=this._parts.hostname.lastIndexOf(".");var i=this._parts.hostname.substring(r+1);if(t!==true&&n&&n.list[i.toLowerCase()]){return n.get(this._parts.hostname)||i}return i}else{var s;if(!e){throw new TypeError("cannot set TLD empty")}else if(e.match(/[^a-zA-Z0-9-]/)){if(n&&n.is(e)){s=new RegExp(a(this.tld())+"$");this._parts.hostname=this._parts.hostname.replace(s,e)}else{throw new TypeError("TLD '"+e+"' contains characters other than [A-Z0-9]")}}else if(!this._parts.hostname||this.is("IP")){throw new ReferenceError("cannot set TLD on non-domain host")}else{s=new RegExp(a(this.tld())+"$");this._parts.hostname=this._parts.hostname.replace(s,e)}this.build(!t);return this}};o.directory=function(e,t){if(this._parts.urn){return e===undefined?"":this}if(e===undefined||e===true){if(!this._parts.path&&!this._parts.hostname){return""}if(this._parts.path==="/"){return"/"}var n=this._parts.path.length-this.filename().length-1;var r=this._parts.path.substring(0,n)||(this._parts.hostname?"/":"");return e?s.decodePath(r):r}else{var i=this._parts.path.length-this.filename().length;var o=this._parts.path.substring(0,i);var u=new RegExp("^"+a(o));if(!this.is("relative")){if(!e){e="/"}if(e.charAt(0)!=="/"){e="/"+e}}if(e&&e.charAt(e.length-1)!=="/"){e+="/"}e=s.recodePath(e);this._parts.path=this._parts.path.replace(u,e);this.build(!t);return this}};o.filename=function(e,t){if(this._parts.urn){return e===undefined?"":this}if(e===undefined||e===true){if(!this._parts.path||this._parts.path==="/"){return""}var n=this._parts.path.lastIndexOf("/");var r=this._parts.path.substring(n+1);return e?s.decodePathSegment(r):r}else{var i=false;if(e.charAt(0)==="/"){e=e.substring(1)}if(e.match(/\.?\//)){i=true}var o=new RegExp(a(this.filename())+"$");e=s.recodePath(e);this._parts.path=this._parts.path.replace(o,e);if(i){this.normalizePath(t)}else{this.build(!t)}return this}};o.suffix=function(e,t){if(this._parts.urn){return e===undefined?"":this}if(e===undefined||e===true){if(!this._parts.path||this._parts.path==="/"){return""}var n=this.filename();var r=n.lastIndexOf(".");var i,o;if(r===-1){return""}i=n.substring(r+1);o=/^[a-z0-9%]+$/i.test(i)?i:"";return e?s.decodePathSegment(o):o}else{if(e.charAt(0)==="."){e=e.substring(1)}var u=this.suffix();var f;if(!u){if(!e){return this}this._parts.path+="."+s.recodePath(e)}else if(!e){f=new RegExp(a("."+u)+"$")}else{f=new RegExp(a(u)+"$")}if(f){e=s.recodePath(e);this._parts.path=this._parts.path.replace(f,e)}this.build(!t);return this}};o.segment=function(e,t,n){var r=this._parts.urn?":":"/";var i=this.path();var s=i.substring(0,1)==="/";var o=i.split(r);if(e!==undefined&&typeof e!=="number"){n=t;t=e;e=undefined}if(e!==undefined&&typeof e!=="number"){throw new Error("Bad segment '"+e+"', must be 0-based integer")}if(s){o.shift()}if(e<0){e=Math.max(o.length+e,0)}if(t===undefined){return e===undefined?o:o[e]}else if(e===null||o[e]===undefined){if(l(t)){o=[];for(var u=0,a=t.length;u<a;u++){if(!t[u].length&&(!o.length||!o[o.length-1].length)){continue}if(o.length&&!o[o.length-1].length){o.pop()}o.push(t[u])}}else if(t||typeof t==="string"){if(o[o.length-1]===""){o[o.length-1]=t}else{o.push(t)}}}else{if(t||typeof t==="string"&&t.length){o[e]=t}else{o.splice(e,1)}}if(s){o.unshift("")}return this.path(o.join(r),n)};o.segmentCoded=function(e,t,n){var r,i,o;if(typeof e!=="number"){n=t;t=e;e=undefined}if(t===undefined){r=this.segment(e,t,n);if(!l(r)){r=r!==undefined?s.decode(r):undefined}else{for(i=0,o=r.length;i<o;i++){r[i]=s.decode(r[i])}}return r}if(!l(t)){t=typeof t==="string"?s.encode(t):t}else{for(i=0,o=t.length;i<o;i++){t[i]=s.decode(t[i])}}return this.segment(e,t,n)};var S=o.query;o.query=function(e,t){if(e===true){return s.parseQuery(this._parts.query,this._parts.escapeQuerySpace)}else if(typeof e==="function"){var n=s.parseQuery(this._parts.query,this._parts.escapeQuerySpace);var r=e.call(this,n);this._parts.query=s.buildQuery(r||n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);this.build(!t);return this}else if(e!==undefined&&typeof e!=="string"){this._parts.query=s.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);this.build(!t);return this}else{return S.call(this,e,t)}};o.setQuery=function(e,t,n){var r=s.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof e==="object"){for(var i in e){if(u.call(e,i)){r[i]=e[i]}}}else if(typeof e==="string"){r[e]=t!==undefined?t:null}else{throw new TypeError("URI.addQuery() accepts an object, string as the name parameter")}this._parts.query=s.buildQuery(r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);if(typeof e!=="string"){n=t}this.build(!n);return this};o.addQuery=function(e,t,n){var r=s.parseQuery(this._parts.query,this._parts.escapeQuerySpace);s.addQuery(r,e,t===undefined?null:t);this._parts.query=s.buildQuery(r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);if(typeof e!=="string"){n=t}this.build(!n);return this};o.removeQuery=function(e,t,n){var r=s.parseQuery(this._parts.query,this._parts.escapeQuerySpace);s.removeQuery(r,e,t);this._parts.query=s.buildQuery(r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);if(typeof e!=="string"){n=t}this.build(!n);return this};o.hasQuery=function(e,t,n){var r=s.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return s.hasQuery(r,e,t,n)};o.setSearch=o.setQuery;o.addSearch=o.addQuery;o.removeSearch=o.removeQuery;o.hasSearch=o.hasQuery;o.normalize=function(){if(this._parts.urn){return this.normalizeProtocol(false).normalizeQuery(false).normalizeFragment(false).build()}return this.normalizeProtocol(false).normalizeHostname(false).normalizePort(false).normalizePath(false).normalizeQuery(false).normalizeFragment(false).build()};o.normalizeProtocol=function(e){if(typeof this._parts.protocol==="string"){this._parts.protocol=this._parts.protocol.toLowerCase();this.build(!e)}return this};o.normalizeHostname=function(n){if(this._parts.hostname){if(this.is("IDN")&&e){this._parts.hostname=e.toASCII(this._parts.hostname)}else if(this.is("IPv6")&&t){this._parts.hostname=t.best(this._parts.hostname)}this._parts.hostname=this._parts.hostname.toLowerCase();this.build(!n)}return this};o.normalizePort=function(e){if(typeof this._parts.protocol==="string"&&this._parts.port===s.defaultPorts[this._parts.protocol]){this._parts.port=null;this.build(!e)}return this};o.normalizePath=function(e){if(this._parts.urn){return this}if(!this._parts.path||this._parts.path==="/"){return this}var t;var n=this._parts.path;var r,i;if(n.charAt(0)!=="/"){t=true;n="/"+n}n=n.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/");while(true){r=n.indexOf("/../");if(r===-1){break}else if(r===0){n=n.substring(3);break}i=n.substring(0,r).lastIndexOf("/");if(i===-1){i=r}n=n.substring(0,i)+n.substring(r+3)}if(t&&this.is("relative")){n=n.substring(1)}n=s.recodePath(n);this._parts.path=n;this.build(!e);return this};o.normalizePathname=o.normalizePath;o.normalizeQuery=function(e){if(typeof this._parts.query==="string"){if(!this._parts.query.length){this._parts.query=null}else{this.query(s.parseQuery(this._parts.query,this._parts.escapeQuerySpace))}this.build(!e)}return this};o.normalizeFragment=function(e){if(!this._parts.fragment){this._parts.fragment=null;this.build(!e)}return this};o.normalizeSearch=o.normalizeQuery;o.normalizeHash=o.normalizeFragment;o.iso8859=function(){var e=s.encode;var t=s.decode;s.encode=escape;s.decode=decodeURIComponent;this.normalize();s.encode=e;s.decode=t;return this};o.unicode=function(){var e=s.encode;var t=s.decode;s.encode=v;s.decode=unescape;this.normalize();s.encode=e;s.decode=t;return this};o.readable=function(){var t=this.clone();t.username("").password("").normalize();var n="";if(t._parts.protocol){n+=t._parts.protocol+"://"}if(t._parts.hostname){if(t.is("punycode")&&e){n+=e.toUnicode(t._parts.hostname);if(t._parts.port){n+=":"+t._parts.port}}else{n+=t.host()}}if(t._parts.hostname&&t._parts.path&&t._parts.path.charAt(0)!=="/"){n+="/"}n+=t.path(true);if(t._parts.query){var r="";for(var i=0,o=t._parts.query.split("&"),u=o.length;i<u;i++){var a=(o[i]||"").split("=");r+="&"+s.decodeQuery(a[0],this._parts.escapeQuerySpace).replace(/&/g,"%26");if(a[1]!==undefined){r+="="+s.decodeQuery(a[1],this._parts.escapeQuerySpace).replace(/&/g,"%26")}}n+="?"+r.substring(1)}n+=s.decodeQuery(t.hash(),true);return n};o.absoluteTo=function(e){var t=this.clone();var n=["protocol","username","password","hostname","port"];var r,i,o;if(this._parts.urn){throw new Error("URNs do not have any generally defined hierarchical components")}if(!(e instanceof s)){e=new s(e)}if(!t._parts.protocol){t._parts.protocol=e._parts.protocol}if(this._parts.hostname){return t}for(i=0;o=n[i];i++){t._parts[o]=e._parts[o]}n=["query","path"];for(i=0;o=n[i];i++){if(!t._parts[o]&&e._parts[o]){t._parts[o]=e._parts[o]}}if(t.path().charAt(0)!=="/"){r=e.directory();t._parts.path=(r?r+"/":"")+t._parts.path;t.normalizePath()}t.build();return t};o.relativeTo=function(e){var t=this.clone().normalize();var n,r,i,o,u;if(t._parts.urn){throw new Error("URNs do not have any generally defined hierarchical components")}e=(new s(e)).normalize();n=t._parts;r=e._parts;o=t.path();u=e.path();if(o.charAt(0)!=="/"){throw new Error("URI is already relative")}if(u.charAt(0)!=="/"){throw new Error("Cannot calculate a URI relative to another relative URI")}if(n.protocol===r.protocol){n.protocol=null}if(n.username!==r.username||n.password!==r.password){return t.build()}if(n.protocol!==null||n.username!==null||n.password!==null){return t.build()}if(n.hostname===r.hostname&&n.port===r.port){n.hostname=null;n.port=null}else{return t.build()}if(o===u){n.path="";return t.build()}i=s.commonPath(t.path(),e.path());if(!i){return t.build()}var a=r.path.substring(i.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");n.path=a+n.path.substring(i.length);return t.build()};o.equals=function(e){var t=this.clone();var n=new s(e);var r={};var i={};var o={};var a,f,c;t.normalize();n.normalize();if(t.toString()===n.toString()){return true}a=t.query();f=n.query();t.query("");n.query("");if(t.toString()!==n.toString()){return false}if(a.length!==f.length){return false}r=s.parseQuery(a,this._parts.escapeQuerySpace);i=s.parseQuery(f,this._parts.escapeQuerySpace);for(c in r){if(u.call(r,c)){if(!l(r[c])){if(r[c]!==i[c]){return false}}else if(!p(r[c],i[c])){return false}o[c]=true}}for(c in i){if(u.call(i,c)){if(!o[c]){return false}}}return true};o.duplicateQueryParameters=function(e){this._parts.duplicateQueryParameters=!!e;return this};o.escapeQuerySpace=function(e){this._parts.escapeQuerySpace=!!e;return this};return s})